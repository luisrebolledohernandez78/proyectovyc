{% load static %}

<!doctype html>

<html lang="es">

  <head>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Gestion de Usuarios | Proyecto VyC</title>

    <link rel="stylesheet" href="{% static 'css/theme.css' %}">

    <script src="https://cdn.tailwindcss.com"></script>

    <style>

      :root {

        color-scheme: dark;

      }

      body {

        min-height: 100vh;

        background:

          radial-gradient(circle at 12% 18%, rgba(34, 211, 238, 0.35) 0%, rgba(34, 211, 238, 0.11) 32%, transparent 60%),

          radial-gradient(circle at 82% 78%, rgba(250, 204, 21, 0.22) 0%, rgba(250, 204, 21, 0.08) 28%, transparent 62%),

          radial-gradient(circle at top right, #1a3f9f 0%, rgba(17, 37, 94, 0.88) 45%, rgba(5, 14, 38, 0.96) 100%);

        background-attachment: fixed;

      }

      body::before {

        content: "";

        position: fixed;

        inset: 0;

        pointer-events: none;

        background-image: url("https://www.transparenttextures.com/patterns/stardust.png");

        mix-blend-mode: screen;

        opacity: 0.18;

        filter: brightness(1.7);

      }

      .rounded-sm { border-radius: 0.0625rem !important; }

      .rounded { border-radius: 0.125rem !important; }

      .rounded-md { border-radius: 0.1875rem !important; }

      .rounded-lg { border-radius: 0.25rem !important; }

      .rounded-xl { border-radius: 0.3125rem !important; }

      .rounded-2xl { border-radius: 0.375rem !important; }

      .rounded-3xl { border-radius: 0.5rem !important; }

      .rounded-full { border-radius: 9999px !important; }

      .glass-panel {

        border: 1px solid rgba(103, 232, 249, 0.28);

        background: linear-gradient(

          150deg,

          rgba(34, 211, 238, 0.12) 0%,

          rgba(5, 20, 51, 0.78) 58%,

          rgba(250, 204, 21, 0.12) 100%

        );

        box-shadow: 0 45px 95px -60px rgba(6, 182, 212, 0.65);

      }

      .glass-card {

        border: 1px solid rgba(103, 232, 249, 0.26);

        background: linear-gradient(

          150deg,

          rgba(34, 211, 238, 0.16) 0%,

          rgba(5, 20, 51, 0.82) 60%,

          rgba(71, 116, 210, 0.14) 100%

        );

        box-shadow: 0 32px 70px -50px rgba(34, 211, 238, 0.58);

      }

    </style>

  </head>

  <body class="min-h-screen text-cyan-50">

    <div class="relative flex min-h-screen overflow-x-hidden">

      <div class="pointer-events-none absolute inset-0 opacity-60 mix-blend-screen">

        <div class="absolute -top-28 right-[15%] h-72 w-72 rounded-full bg-cyan-400/25 blur-[140px]"></div>

        <div class="absolute bottom-[-22%] left-[12%] h-96 w-96 rounded-full bg-amber-300/18 blur-[180px]"></div>

      </div>

      <aside class="sticky top-0 flex h-screen w-72 flex-shrink-0 flex-col border-r border-cyan-400/20 bg-gradient-to-b from-[#071a4c]/96 via-[#051433]/94 to-[#04091f]/98">

        <div class="border-b border-cyan-400/15 px-6 py-8">

          <div class="inline-flex items-center gap-3 rounded-full border border-cyan-300/40 bg-cyan-500/10 px-4 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-cyan-100/90">

            <span class="h-1.5 w-1.5 rounded-full bg-amber-300 shadow-[0_0_12px_rgba(250,204,21,0.8)]"></span>

            VyC Ingeniería

          </div>

          <h1 class="mt-4 bg-gradient-to-r from-amber-200 via-amber-300 to-amber-100 bg-clip-text text-2xl font-extrabold text-transparent drop-shadow-[0_0_14px_rgba(250,204,21,0.35)]">
            Gestión Interna
          </h1>

          <p class="mt-2 text-sm text-cyan-100/80">

            Administra credenciales, accesos y estados desde un único lugar.

          </p>

        </div>

        <nav class="flex-1 space-y-5 overflow-y-auto px-6 py-6">

          <div class="space-y-2">

            <p class="text-[0.58rem] font-semibold uppercase tracking-[0.35em] text-cyan-100/60">

              Operaciones

            </p>

            <a

              href="#usuarios"

              class="block rounded-lg border border-cyan-300/35 bg-white/10 px-4 py-2 text-sm font-semibold text-cyan-100/85 transition-all hover:border-amber-300/40 hover:bg-white/16 hover:text-cyan-50"

            >

              Usuarios

            </a>

            <div class="rounded-lg border border-cyan-300/30 bg-white/10 px-4 py-2 text-xs uppercase tracking-[0.35em] text-cyan-100/60">
              Solo Usuarios
            </div>

          </div>

          

        </nav>

        <div class="px-6 pb-8">
          {% if show_full_management %}
            <a
              href="{% url 'user-management' %}"
              class="btn-3d w-full text-xs uppercase px-4 py-3 inline-flex items-center justify-center gap-2 mb-4 tracking-wide"
            >
              <span class="btn-icon" aria-hidden="true" data-icon-default="&#x1F464;" data-icon-active="&#x1F465;">&#x1F464;</span>
              <span>Cerrar Usuarios</span>
            </a>
          {% endif %}
          <a
            href="{% url 'intranet-home' %}"
            class="btn-3d w-full text-xs uppercase px-4 py-3 inline-flex items-center justify-center gap-2 mb-4 tracking-wide"
          >
            <span class="btn-icon" aria-hidden="true" data-icon-default="&#x1F3E0;" data-icon-active="&#x1F3E1;">&#x1F3E0;</span>
            <span>Volver al Home</span>
          </a>
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="btn-3d w-full text-xs uppercase px-4 py-3 inline-flex items-center justify-center gap-2 tracking-wide">
              <span class="btn-icon" aria-hidden="true" data-icon-default="&#x1F6AA;" data-icon-active="&#x1F6AA;">&#x1F6AA;</span>
              <span>Salir</span>
            </button>
          </form>
        </div>

      </aside>

      <main class="relative flex-1 px-6 py-10 md:px-10 lg:px-16">

        {% if messages %}

          <div class="mb-8 space-y-3">

            {% for message in messages %}

              <div

                class="rounded-2xl border px-6 py-4 text-sm shadow-lg backdrop-blur-md {% if message.tags == 'error' %}border-red-500/40 bg-red-500/15 text-red-100{% else %}border-cyan-300/35 bg-white/12 text-cyan-100{% endif %}"

              >

                {{ message }}

              </div>

            {% endfor %}

          </div>

        {% endif %}

        

        <section id="usuarios" class="space-y-12">

          <header class="space-y-2">

            <h2 class="bg-gradient-to-r from-amber-200 via-amber-300 to-amber-100 bg-clip-text text-3xl font-extrabold text-transparent drop-shadow-[0_0_18px_rgba(250,204,21,0.35)]">

              Usuarios

            </h2>

            <p class="text-sm text-cyan-100/75">

              Da de alta nuevos perfiles y controla la informacion de quienes ya forman parte del equipo.

            </p>

          </header>

          {% if show_full_management %}

          <section id="usuarios-crear" class="glass-panel rounded-3xl px-6 py-6 space-y-4 backdrop-blur-xl">

            <header class="space-y-2">

              <h3 class="text-2xl font-bold text-cyan-100">Crear nuevo usuario</h3>

              <p class="text-sm text-cyan-100/75">

                Define cuentas internas o personal administrativo. Puedes otorgar acceso al panel de administración cuando sea necesario.

              </p>

            </header>

                        <form method="post" class="space-y-3">
              {% csrf_token %}
              <input type="hidden" name="action" value="update">
              <input type="hidden" name="user_id" value="{{ user.id }}">

              <div class="flex flex-col gap-1 md:flex-row md:items-center md:gap-4">
                <label class="text-xs font-semibold uppercase tracking-[0.3em] text-cyan-100/80 md:w-40 md:text-[0.7rem]">
                  Correo
                </label>
                <input
                  name="email"
                  value="{{ user.email }}"
                  class="flex-1 rounded-md border border-white/10 bg-white/10 px-3 py-1.5 text-sm text-cyan-50 focus:border-cyan-200 focus:outline-none focus:ring-2 focus:ring-cyan-300/40"
                >
              </div>

              <div class="flex flex-col gap-1 md:flex-row md:items-center md:gap-4">
                <label class="text-xs font-semibold uppercase tracking-[0.3em] text-cyan-100/80 md:w-40 md:text-[0.7rem]">
                  Nueva contrase&ntilde;a
                </label>
                <input
                  name="new_password"
                  type="password"
                  placeholder="Mantener actual"
                  class="flex-1 rounded-md border border-white/10 bg-white/10 px-3 py-1.5 text-sm text-cyan-50 focus:border-cyan-200 focus:outline-none focus:ring-2 focus:ring-cyan-300/40"
                >
              </div>

              <div class="flex flex-col gap-2 md:flex-row md:items-center md:gap-4">
                <span class="text-xs font-semibold uppercase tracking-[0.3em] text-cyan-100/80 md:w-40 md:text-[0.7rem]">
                  Permisos
                </span>
                <div class="flex flex-wrap gap-4">
                  <label class="flex items-center gap-2 text-xs text-cyan-100/80">
                    <input
                      type="checkbox"
                      name="is_staff"
                      {% if user.is_staff %}checked{% endif %}
                      class="h-4 w-4 rounded border-cyan-300 bg-white/10 text-cyan-300 focus:ring-cyan-200"
                    >
                    Staff
                  </label>
                  <label class="flex items-center gap-2 text-xs text-cyan-100/80">
                    <input
                      type="checkbox"
                      name="is_active"
                      {% if user.is_active %}checked{% endif %}
                      class="h-4 w-4 rounded border-cyan-300 bg-white/10 text-cyan-300 focus:ring-cyan-200"
                    >
                    Activo
                  </label>
                </div>
              </div>

              <div class="flex justify-end">
                <button type="submit" class="btn-3d px-6 py-2 text-xs uppercase tracking-[0.3em]">
                  Guardar cambios
                </button>
              </div>
            </form>

          </section>

          {% endif %}

          <section id="usuarios-resumen" class="space-y-6">

            <header class="space-y-2">

              <h3 class="text-2xl font-bold text-cyan-100">Usuarios</h3>

              <p class="text-sm text-cyan-100/75">

                Revisa rapidamente quienes tienen acceso activo. Se muestran los primeros usuarios registrados a modo de planilla.

              </p>

            </header>

            <div class="glass-panel rounded-3xl px-0 py-6 backdrop-blur-xl">

              <div class="overflow-x-auto">

                <table class="min-w-full text-left text-sm text-cyan-100/80">

                  <thead class="text-[0.65rem] uppercase tracking-[0.35em] text-cyan-100/60">

                    <tr class="border-b border-cyan-300/20">

                      <th scope="col" class="px-6 py-3">Usuario</th>

                      <th scope="col" class="px-6 py-3">Correo</th>

                      <th scope="col" class="px-6 py-3">Rol</th>

                      <th scope="col" class="px-6 py-3">Estado</th>

                      <th scope="col" class="px-6 py-3">Acciones</th>

                    </tr>

                  </thead>

                  <tbody class="divide-y divide-cyan-300/10 text-xs">

                    {% for user in users|slice:":8" %}

                      <tr class="transition-colors hover:bg-white/5">

                        <td class="px-6 py-4">

                          <span class="font-semibold text-cyan-50">@{{ user.username }}</span>

                        </td>

                        <td class="px-6 py-4">

                          {{ user.email|default:"Sin correo" }}

                        </td>

                        <td class="px-6 py-4">

                          {% if user.is_superuser %}

                            Superusuario

                          {% elif user.is_staff %}

                            Staff

                          {% else %}

                            Usuario estándar

                          {% endif %}

                        </td>

                        <td class="px-6 py-4">

                          {% if user.is_active %}

                            <span class="inline-flex items-center gap-2 rounded-full border border-cyan-300/30 bg-cyan-500/10 px-3 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.3em] text-cyan-100/80">

                              <span class="h-1.5 w-1.5 rounded-full bg-cyan-300"></span>

                              Activo

                            </span>

                          {% else %}

                            <span class="inline-flex items-center gap-2 rounded-full border border-amber-300/30 bg-amber-400/10 px-3 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.3em] text-amber-100/80">

                              <span class="h-1.5 w-1.5 rounded-full bg-amber-300"></span>

                              Inactivo

                            </span>

                          {% endif %}

                        </td>

                        <td class="px-6 py-4">

                          {% if show_full_management %}

                            <details class="group">

                              <summary class="flex cursor-pointer items-center gap-2 text-[0.65rem] font-semibold uppercase tracking-[0.3em] text-cyan-100/75 transition-colors hover:text-cyan-50">

                                Gestionar

                                <span class="transition-transform group-open:rotate-180">&#9662;</span>

                              </summary>

                              <div class="mt-4 space-y-4 rounded-2xl border border-white/10 bg-white/10 p-4 text-left backdrop-blur">

                                <form method="post" class="space-y-3">

                                  {% csrf_token %}

                                  <input type="hidden" name="action" value="update">

                                  <input type="hidden" name="user_id" value="{{ user.id }}">

                                  <div class="flex flex-col gap-1 md:flex-row md:items-center md:gap-4">

                                    <label class="text-xs font-semibold uppercase tracking-[0.3em] text-cyan-100/80 md:w-40 md:text-[0.7rem]">

                                      Correo

                                    </label>

                                    <input

                                      name="email"

                                      value="{{ user.email }}"

                                      class="flex-1 rounded-md border border-white/10 bg-white/10 px-3 py-1.5 text-sm text-cyan-50 focus:border-cyan-200 focus:outline-none focus:ring-2 focus:ring-cyan-300/40"

                                    >

                                  </div>

                                  <div class="flex flex-col gap-1 md:flex-row md:items-center md:gap-4">

                                    <label class="text-xs font-semibold uppercase tracking-[0.3em] text-cyan-100/80 md:w-40 md:text-[0.7rem]">

                                      Nueva contrase&ntilde;a

                                    </label>

                                    <input

                                      name="new_password"

                                      type="password"

                                      placeholder="Mantener actual"

                                      class="flex-1 rounded-md border border-white/10 bg-white/10 px-3 py-1.5 text-sm text-cyan-50 focus:border-cyan-200 focus:outline-none focus:ring-2 focus:ring-cyan-300/40"

                                    >

                                  </div>

                                  <div class="flex flex-col gap-2 md:flex-row md:items-center md:gap-4">

                                    <span class="text-xs font-semibold uppercase tracking-[0.3em] text-cyan-100/80 md:w-40 md:text-[0.7rem]">

                                      Permisos

                                    </span>

                                    <div class="flex flex-wrap gap-4">

                                      <label class="flex items-center gap-2 text-xs text-cyan-100/80">

                                        <input

                                          type="checkbox"

                                          name="is_staff"

                                          {% if user.is_staff %}checked{% endif %}

                                          class="h-4 w-4 rounded border-cyan-300 bg-white/10 text-cyan-300 focus:ring-cyan-200"

                                        >

                                        Staff

                                      </label>

                                      <label class="flex items-center gap-2 text-xs text-cyan-100/80">

                                        <input

                                          type="checkbox"

                                          name="is_active"

                                          {% if user.is_active %}checked{% endif %}

                                          class="h-4 w-4 rounded border-cyan-300 bg-white/10 text-cyan-300 focus:ring-cyan-200"

                                        >

                                        Activo

                                      </label>

                                    </div>

                                  </div>

                                  <div class="flex justify-end">

                                    <button type="submit" class="btn-3d px-6 py-2 text-xs uppercase tracking-[0.3em]">

                                      Guardar cambios

                                    </button>

                                  </div>

                                </form>

                                <form method="post">

                                  {% csrf_token %}

                                  <input type="hidden" name="action" value="delete">

                                  <input type="hidden" name="user_id" value="{{ user.id }}">

                                  {% if user.is_superuser %}

                                    <button type="button" disabled class="btn-3d text-xs">Eliminar</button>

                                  {% else %}

                                    <button type="submit" class="btn-3d btn-3d--danger text-xs">Eliminar</button>

                                  {% endif %}

                                </form>

                              </div>

                            </details>

                          {% else %}

                            <a

                              href="{% url 'user-management-crud' %}?focus={{ user.id }}"

                              class="inline-flex items-center justify-center rounded-full border border-cyan-300/30 bg-cyan-500/10 px-4 py-1 text-[0.6rem] font-semibold uppercase tracking-[0.3em] text-cyan-100/80 transition-colors hover:border-cyan-300/50 hover:text-cyan-50"

                            >

                              Gestionar

                            </a>

                          {% endif %}

                        </td>

                      </tr>

                    {% empty %}

                      <tr>

                        <td colspan="5" class="px-6 py-6 text-center text-sm text-cyan-100/70">

                          No hay usuarios registrados.

                        </td>

                      </tr>

                    {% endfor %}

                  </tbody>

                </table>

              </div>

            </div>

            {% if users|length > 8 %}

              <p class="text-xs uppercase tracking-[0.3em] text-cyan-100/60">

                Mostrando los primeros 8 usuarios. Utiliza la gestin detallada para ver el listado completo.

              </p>

            {% endif %}

          </section>

        </section>

      </main>

    </div>

  </body>

</html>


